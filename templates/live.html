<html>
<head>
	<title>Live page</title>


	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="/static/css/bootstrap.css" rel="stylesheet">
	<link href="/static/css/bootstrap-responsive.css" rel="stylesheet">
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="/static/js/bootstrap.js"></script>
	<script src="/static/js/jquery.tableSort.js"></script>

	<script src="http://js.pusher.com/1.12/pusher.min.js" type="text/javascript"></script>
	<script type="text/javascript">
	    // Enable pusher logging - don't include this in production
	    Pusher.log = function(message) {
	      if (window.console && window.console.log) window.console.log(message);
	    };

	    // Flash fallback logging - don't include this in production
	    WEB_SOCKET_DEBUG = true;

	    var pusher = new Pusher('b2c9525770d59267a6a2');
	    var channel = pusher.subscribe('test_channel');
	    channel.bind('ticker', function(data) {
    		$(data.message).prependTo('#update').hide();
    		$('span').tooltip();
    		$('li').show(600);
	    });
	</script>


</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top">
<div class="navbar-inner">
    <a class="brand" href="/">LiveFPL</a>
    <a href="#" class="btn btn-success">Refresh</a>
    <ul class="nav">

    	<li class="dropdown"><a id="leagues" href="#"  class="dropdown-toggle" data-toggle="dropdown">Leagues <b class="caret"></b></a>
    		<ul class="dropdown-menu">
    			{% for league in leagues %}
    				{% if league[1]['players'] != '0' %}
    					{% if league[1]['type'] == 'classic' %}
    						<li><a href="/live?league_id={{league[0]}}&team_id={{team_id}}">{{ league[1]['leaguename'] }} (Classic)</a></li>
    					{% else %}
    						<li><a href="/live?league_id={{league[0]}}&team_id={{team_id}}">{{ league[1]['leaguename'] }} (H2H)</a></li>
    				{% endif %}
    				{% else %}
    				{% endif %}
    			{% endfor %}
    		</ul>
    	</li>
    </ul>
  </div>
</div>

<div class="container-fluid">
	<div class="span8">
		<h4>{{ leaguename }}</h4>
		{% if league_data[0] != 'None'  %}

		<table class="table table-bordered" id="xtable">
			<thead>
				<tr>
					<th>Team Name</th>
					<th rel='tooltip' data-title='Total Point for the gameweek {{currentgw}}'>Current GW</th>
					<th rel='tooltip'data-title='Total Point for this season, including this GW points'>Total Points</th>
				</tr>
			</thead>
			<tbody>		
			{% for team in league_data %}
				{% if team['id'] == team_id %}
					<tr class="my-team">
						<td>{{ team['teamname'] }}</td>
						<td>{{ team['gwpts'] }}</td>
						<td>{{ team['totalpts']}} </td>
					</tr>
				{% else %}
					<tr>
						<td>{{ team['teamname'] }}</td>
						<td>{{ team['gwpts'] }}</td>
						<td>{{ team['totalpts']}} </td>
					</tr>
				{% endif %}
			{% endfor %}
		</tbody>	
		</table>
		{% else %}
		<p>Sorry, your league is not supported by LiveFPL because it has more than 25 players.</p>
		{% endif %}
	</div>
	<div class="span4">
		<div class="row-fluid">
		<h4>status is: <span id='status'><span></h4>	
		</div>
		<div class="row-fluid">
					<h4>Ticker</h4>
					<div style="background-color:#F8E4E4;height:186px;overflow-y:scroll;">
						<ul id="update" class="nav nav-tabs nav-stacked">
						  {% for update in pushed_data -%}
						  	{{ update | safe}}
							{%- endfor %}
						<div>
						
						</ul>
				</div>
		</div>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function(){
	$('[rel=tooltip]').tooltip();
	$.get('/status', function(data) {
		console.log(data)
		$('#status').text('')
		$('#status').append(data)
	});
});


//Table sorting $('#xtable').sortTable({onCol:2,sortDesc:true, keepRelationships:true})


// Check for status update
window.setInterval(function(){
		$.get('/status', function(data) {
			if ( data != $('#status').text()) {
				$('#status').text('')
				$('#status').append(data)
			};
	});
}, 60000);
</script>
</body>
</html>